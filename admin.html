<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Sinhala', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden flex">

    <!-- Sidebar -->
    <aside class="w-64 bg-slate-900 text-white flex flex-col shadow-xl">
        <div class="p-6 border-b border-slate-700 flex items-center gap-3">
            <i class="fas fa-graduation-cap text-2xl text-blue-400"></i>
            <span class="text-xl font-bold">Smart LMS</span>
        </div>
        <nav class="flex-1 p-4 space-y-2 mt-4">
            <button onclick="showSection('analytics', event)" class="nav-item w-full flex items-center p-3 rounded-lg bg-blue-600 hover:bg-blue-700 transition text-left">
                <i class="fas fa-chart-line w-8"></i> දත්ත විශ්ලේෂණ
            </button>
            <button onclick="showSection('studypacks', event)" class="nav-item w-full flex items-center p-3 rounded-lg hover:bg-slate-800 transition text-left">
                <i class="fas fa-book-open w-8"></i> පාඩම් මාලා (Study Packs)
            </button>
            <button onclick="showSection('liveclasses', event)" class="nav-item w-full flex items-center p-3 rounded-lg hover:bg-slate-800 transition text-left">
                <i class="fas fa-broadcast-tower w-8"></i> Live Classes
            </button>
            <button onclick="showSection('recordings', event)" class="nav-item w-full flex items-center p-3 rounded-lg hover:bg-slate-800 transition text-left">
                <i class="fas fa-play-circle w-8"></i> Recordings
            </button>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden">
        <header class="bg-white shadow-sm h-16 flex justify-between items-center px-8">
            <h2 id="page-title" class="text-xl font-bold text-gray-800">දත්ත විශ්ලේෂණ</h2>
        </header>

        <div id="content-container" class="flex-1 overflow-y-auto p-8">
            <!-- Analytics Section -->
            <div id="section-analytics" class="space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500">
                    <h3 class="text-2xl font-bold">සාදරයෙන් පිළිගනිමු!</h3>
                    <p class="text-gray-600">පද්ධතියේ දත්ත මෙතැනින් පරීක්ෂා කළ හැක.</p>
                </div>
            </div>

            <!-- Study Packs Section -->
            <div id="section-studypacks" class="hidden space-y-6">
                 <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">අලුත් Study Pack එකක් එකතු කරන්න</h3>
                    <div class="flex flex-col md:flex-row gap-4">
                        <input type="text" id="pack-name" placeholder="Study Pack Name" class="flex-1 p-3 border rounded-lg outline-none">
                        <input type="number" id="pack-price" placeholder="Price (LKR)" class="w-40 p-3 border rounded-lg outline-none">
                        <button id="upload-pack-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg font-bold transition">Add Pack</button>
                    </div>
                 </div>
                 <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">පවතින Study Packs</h3>
                    <div id="packs-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                 </div>
            </div>

            <!-- Live Classes Section -->
            <div id="section-liveclasses" class="hidden space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">නව Live Class එකක් එක් කරන්න</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="live-name" placeholder="Class Name" class="p-3 border rounded-lg outline-none">
                        <input type="datetime-local" id="live-time" class="p-3 border rounded-lg outline-none">
                        <input type="text" id="live-link" placeholder="Zoom/Meet Link" class="p-3 border rounded-lg outline-none">
                    </div>
                    <button id="add-live-btn" class="mt-4 bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition">
                        Add Live Class
                    </button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">සැලසුම් කර ඇති Live පන්ති</h3>
                    <div id="live-list" class="space-y-4"></div>
                </div>
            </div>

            <!-- Recordings Section -->
            <div id="section-recordings" class="hidden space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">නව Recording එකක් එක් කරන්න</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="rec-name" placeholder="Video Title" class="p-3 border rounded-lg outline-none">
                        <input type="text" id="rec-link" placeholder="Video URL (YouTube/Drive)" class="p-3 border rounded-lg outline-none">
                    </div>
                    <button id="add-rec-btn" class="mt-4 bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                        Add Recording
                    </button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">පවතින Recordings</h3>
                    <div id="rec-list" class="space-y-4"></div>
                </div>
            </div>

            <!-- Lessons Section (Dynamic) -->
            <div id="section-lessons" class="hidden space-y-6">
                <button onclick="showSection('studypacks')" class="text-blue-600 hover:underline flex items-center gap-2 mb-4">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 id="current-pack-title" class="text-xl font-bold text-gray-800 mb-4">පාඩම් කළමනාකරණය</h3>
                    <div class="grid grid-cols-1 gap-4">
                        <input type="text" id="lesson-name" placeholder="Lesson Name" class="p-3 border rounded-lg outline-none">
                        <textarea id="lesson-desc" placeholder="Lesson Description" class="p-3 border rounded-lg outline-none h-24"></textarea>
                        <input type="text" id="lesson-url" placeholder="YouTube URL" class="p-3 border rounded-lg outline-none">
                        <button id="add-lesson-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition">Save Lesson</button>
                    </div>
                </div>
                <div id="lessons-list" class="space-y-4 mt-4"></div>
            </div>
        </div>
    </main>

    <script>
        function showSection(sectionId, event) {
            document.getElementById('section-analytics').classList.add('hidden');
            document.getElementById('section-studypacks').classList.add('hidden');
            document.getElementById('section-lessons').classList.add('hidden');
            document.getElementById('section-liveclasses').classList.add('hidden');
            document.getElementById('section-recordings').classList.add('hidden');
            
            document.getElementById('section-' + sectionId).classList.remove('hidden');
            
            const titles = { 
                'analytics': 'දත්ත විශ්ලේෂණ', 
                'studypacks': 'පාඩම් මාලා (Study Packs)', 
                'liveclasses': 'Live Classes කළමනාකරණය',
                'recordings': 'Recordings කළමනාකරණය'
            };
            if(titles[sectionId]) document.getElementById('page-title').innerText = titles[sectionId];

            if(sectionId !== 'lessons') {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('bg-blue-600');
                    item.classList.add('hover:bg-slate-800');
                });
                if (event) event.currentTarget.classList.add('bg-blue-600');
            }
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, set, serverTimestamp, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDUvR4OkKz0IQju7dRGju6uDnEYdeyVe3g",
            authDomain: "malinda-lms.firebaseapp.com",
            databaseURL: "https://malinda-lms-default-rtdb.firebaseio.com",
            projectId: "malinda-lms",
            storageBucket: "malinda-lms.firebasestorage.app",
            messagingSenderId: "668911175736",
            appId: "1:668911175736:web:01b3732c6313e696603ecd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const appId = "malinda-lms";

        // --- STUDY PACKS ---
        const packsListContainer = document.getElementById('packs-list');
        onValue(ref(db, `artifacts/${appId}/public/data/study_packs`), (snapshot) => {
            const data = snapshot.val();
            packsListContainer.innerHTML = '';
            if (data) {
                Object.keys(data).forEach(key => {
                    const pack = data[key];
                    const div = document.createElement('div');
                    div.className = "bg-white border p-4 rounded-lg shadow-sm flex flex-col justify-between";
                    div.innerHTML = `<div><h4 class="font-bold">${pack.name}</h4><p class="text-blue-600 font-bold">LKR ${pack.price}</p></div>
                        <button class="mt-4 bg-slate-800 text-white py-2 px-4 rounded hover:bg-slate-700 text-sm" onclick="window.manageLessons('${key}', '${pack.name}')">Manage Lessons</button>`;
                    packsListContainer.appendChild(div);
                });
            }
        });

        document.getElementById('upload-pack-btn').addEventListener('click', async () => {
            const name = document.getElementById('pack-name').value;
            const price = document.getElementById('pack-price').value;
            if(name && price) {
                const newRef = push(ref(db, `artifacts/${appId}/public/data/study_packs`));
                await set(newRef, { name, price: parseFloat(price), createdAt: serverTimestamp() });
                document.getElementById('pack-name').value = ''; document.getElementById('pack-price').value = '';
            }
        });

        // --- LIVE CLASSES ---
        const liveListContainer = document.getElementById('live-list');
        document.getElementById('add-live-btn').addEventListener('click', async () => {
            const name = document.getElementById('live-name').value;
            const time = document.getElementById('live-time').value;
            const link = document.getElementById('live-link').value;
            if(name && time && link) {
                const newRef = push(ref(db, `artifacts/${appId}/public/data/live_classes`));
                await set(newRef, { name, time, link, createdAt: serverTimestamp() });
                document.getElementById('live-name').value = ''; document.getElementById('live-time').value = ''; document.getElementById('live-link').value = '';
            }
        });

        onValue(ref(db, `artifacts/${appId}/public/data/live_classes`), (snapshot) => {
            const data = snapshot.val();
            liveListContainer.innerHTML = '';
            if (data) {
                Object.keys(data).forEach(key => {
                    const cls = data[key];
                    const div = document.createElement('div');
                    div.className = "p-4 border rounded-lg bg-gray-50 flex justify-between items-center";
                    div.innerHTML = `<div><h5 class="font-bold">${cls.name}</h5><p class="text-sm text-gray-600">${new Date(cls.time).toLocaleString()}</p></div>
                        <a href="${cls.link}" target="_blank" class="bg-blue-100 text-blue-600 py-1 px-4 rounded-full text-sm font-bold">Join Class</a>`;
                    liveListContainer.appendChild(div);
                });
            }
        });

        // --- RECORDINGS ---
        const recListContainer = document.getElementById('rec-list');
        document.getElementById('add-rec-btn').addEventListener('click', async () => {
            const name = document.getElementById('rec-name').value;
            const link = document.getElementById('rec-link').value;
            if(name && link) {
                const newRef = push(ref(db, `artifacts/${appId}/public/data/recordings`));
                await set(newRef, { name, link, createdAt: serverTimestamp() });
                document.getElementById('rec-name').value = ''; document.getElementById('rec-link').value = '';
            }
        });

        onValue(ref(db, `artifacts/${appId}/public/data/recordings`), (snapshot) => {
            const data = snapshot.val();
            recListContainer.innerHTML = '';
            if (data) {
                Object.keys(data).forEach(key => {
                    const rec = data[key];
                    const div = document.createElement('div');
                    div.className = "p-4 border rounded-lg bg-gray-50 flex justify-between items-center";
                    div.innerHTML = `<div><h5 class="font-bold">${rec.name}</h5></div>
                        <a href="${rec.link}" target="_blank" class="bg-purple-100 text-purple-600 py-1 px-4 rounded-full text-sm font-bold">Watch Now</a>`;
                    recListContainer.appendChild(div);
                });
            }
        });

        // --- LESSONS ---
        let activePackId = null;
        window.manageLessons = (id, name) => {
            activePackId = id;
            document.getElementById('current-pack-title').innerText = `${name} - Lessons`;
            showSection('lessons');
            onValue(ref(db, `artifacts/${appId}/public/data/lessons/${id}`), (snapshot) => {
                const data = snapshot.val();
                const container = document.getElementById('lessons-list');
                container.innerHTML = '';
                if(data) {
                    Object.keys(data).forEach(k => {
                        const l = data[k];
                        container.innerHTML += `<div class="p-4 border rounded-lg bg-white shadow-sm">
                            <h5 class="font-bold">${l.name}</h5><p class="text-sm text-gray-500">${l.description}</p></div>`;
                    });
                }
            });
        };

        document.getElementById('add-lesson-btn').addEventListener('click', async () => {
            const name = document.getElementById('lesson-name').value;
            const desc = document.getElementById('lesson-desc').value;
            const url = document.getElementById('lesson-url').value;
            if(name && url && activePackId) {
                const newRef = push(ref(db, `artifacts/${appId}/public/data/lessons/${activePackId}`));
                await set(newRef, { name, description: desc, youtubeUrl: url, createdAt: serverTimestamp() });
                document.getElementById('lesson-name').value = ''; document.getElementById('lesson-desc').value = ''; document.getElementById('lesson-url').value = '';
            }
        });
    </script>
</body>
</html>
